<html>
<head>
    <title>Localhost</title>

    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link href="semantic.min.css" rel="stylesheet" type="text/css" />  
    <link href="reveal.css" rel="stylesheet" type="text/css" />   
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js" type="text/javascript"></script>
    <script src="semantic.min.js" type="text/javascript"></script>
    <script src="reveal.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>

</head>
<script>
//Stops the submit request


$( document ).ready(function() {
	
	loadDefault();
	
	$("#editLink").click(function() {
		loadEditData();
	});
	
	$("#myForm").submit(function(e){
	       e.preventDefault();
	});
	
	$("#myButton").click(function(){
	      
		var category = document.getElementById("category").value;
		var gonumber = document.getElementById("goNumber").value;
		var godate = document.getElementById("goDate").value;
		var subject = document.getElementById("subject").value;
			var file = document.getElementById("file").files[0];
			var formdata = new FormData();
			formdata.append("category", category);
			formdata.append("gonumber", gonumber);
			formdata.append("godate", godate);
			formdata.append("subject", subject);
			formdata.append("file", file);
			var xhr = new XMLHttpRequest();       
			xhr.open("POST","CountryInformation?actionval=upload", true);
			xhr.send(formdata);
			xhr.onload = function(e) {
				if (this.status == 200) {
					$("#myForm").hide();
					$("#updateResponse").html();
					$("#updateResponse").append("<p align='center'>Successfully Uploaded</p>");
				}
			};                    
	   
	});
	
});

function loadDefault(){
	 //get the form data and then serialize that
    dataString = $("#myAjaxRequestForm").serialize();
   
    //get the form data using another method 
    var countryCode = $("input#countryCode").val(); 
    dataString = "year=2016";
   
    //make the AJAX request, dataType is set to json
    //meaning we are expecting JSON data in response from the server
    $.ajax({
        type: "POST",
        url: "CountryInformation",
        data: dataString,
        dataType: "json",
       
        //if received a response from the server
        success: function( data, textStatus, jqXHR) {
            //our country code was correct so we have some information to display
             if(data.length>0){
				$("#ajaxResponse").html("");
            	 for(var i=0;i<data.length;i++){
            		 var obj=data[i];
                     $("#ajaxResponse").append("<tr>");
                     $("#ajaxResponse").append("<td> " + obj[0]+ "</td> ");
                     $("#ajaxResponse").append("<td> " + obj[1] + "</td> ");
                     $("#ajaxResponse").append("<td> " + obj[2] + "</td> ");
                     $("#ajaxResponse").append("<td><a href='#' data-reveal-id='myModal' onclick='loadEditData(\""+obj[1]+"\");'>Edit</a></td> ");
                     $("#ajaxResponse").append("</tr>");
            	 }
                 
             } 
             //display error message
             else {
                 $("#ajaxResponse").html("<div><b>Country code in Invalid!</b></div>");
             }
        },
       
        //If there was no resonse from the server
        error: function(jqXHR, textStatus, errorThrown){
             console.log("Something really bad happened " + textStatus);
              $("#ajaxResponse").html(jqXHR.responseText);
        },
       
        //capture the request before it was sent to server
        beforeSend: function(jqXHR, settings){
            //adding some Dummy data to the request
            settings.data += "&dummyData=whatever";
            //disable the button until we get the response
            $('#myButton').attr("disabled", true);
        },
       
        //this is called after the response or error functions are finsihed
        //so that we can take some action
        complete: function(jqXHR, textStatus){
            //enable the button 
            $('#myButton').attr("disabled", false);
        }

    });        
}
function loadEditData(gonumber){
           
  
            
            dataString = "goNumber=" + gonumber;
           
            //make the AJAX request, dataType is set to json
            //meaning we are expecting JSON data in response from the server
            $.ajax({
                type: "POST",
                url: "CountryInformation",
                data: dataString,
                dataType: "json",
               
                //if received a response from the server
                success: function( data, textStatus, jqXHR) {
                    //our country code was correct so we have some information to display
                     if(data.length>0){
						
                    	 for(var i=0;i<data.length;i++){
                    		 var obj=data[i];
                    		 $("#goNumber").val(obj[0]);
                    		 $("#goDate").val(obj[1]);
                    		 $("#subject").val(obj[2]);
                    	 }
                         
                     } 
                     //display error message
                     else {
                         $("#myForm").html("<div><b>Country code in Invalid!</b></div>");
                     }
                },
               
                //If there was no resonse from the server
                error: function(jqXHR, textStatus, errorThrown){
                     console.log("Something really bad happened " + textStatus);
                      $("#myForm").html(jqXHR.responseText);
                },
               
                //capture the request before it was sent to server
                beforeSend: function(jqXHR, settings){
                    //adding some Dummy data to the request
                    settings.data += "&dummyData=whatever";
                    //disable the button until we get the response
                    $('#myForm').attr("disabled", true);
                },
               
                //this is called after the response or error functions are finsihed
                //so that we can take some action
                complete: function(jqXHR, textStatus){
                    //enable the button 
                    $('#myForm').attr("disabled", false);
                }
     
            });        
}
</script>
<body>
<a href="#">Link1</a>
<div style="height:120px">
</div>
   <table class="ui center aligned structured table" style="width:600px">
   	<thead>
   		<tr>
   			<th>Date</th>
   			<th>GO Number</th>
   			<th>Subject</th>
   			<th>Edit</th>
   		</tr>
   	</thead>
   	<tbody id="ajaxResponse">
   	</tbody>
   </table>  
<!-- Modal -->
<div id="myModal" class="reveal-modal">
     				<h1>Edit</h1>
     				<div id="updateResponse"></div>
     				<form  id="myForm" onsubmit="loadData();">
	category:<select name="category" id="category">
				<option value="GO">GO</option>
				<option value="Circular">Circular</option>
				<option value="Memo">Memo</option>
			</select><br/>
	gonumber:<input type="text" value="" name="goNumber" id="goNumber"/><br/>
	godate:<input type="text" value="" name="goDate" id="goDate"/><br/>
	subject:<input type="text" value="" name="subject" id="subject"/><br/>
	File:<input type="file" name="file" id="file"/><br/>
	<input type="submit" value="Submit" id="myButton"/>
</form>
     				<a class="close-reveal-modal" href="index.jsp">&#215;</a>
</div>
</body>
</html>
