<html>
<head>
    <title>Localhost</title>

    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link href="semantic.min.css" rel="stylesheet" type="text/css" />  
    <link rel="stylesheet" href="icon.css" >  
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js" type="text/javascript"></script>
    <script src="semantic.min.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>
<style>
.ui.action.input input[type="file"] {
    display: none;
}
</style>
</head>
<script>
//Stops the submit request


$( document ).ready(function() {
	
	loadDefault();
	
	$("#editLink").click(function() {
		loadEditData();
	});
	
	$("#myForm").submit(function(e){
	       e.preventDefault();
	});
	
	$("#myButton").click(function(){
	      
		var category = document.getElementById("category").value;
		var gonumber = document.getElementById("goNumber").value;
		var godate = document.getElementById("goDate").value;
		var subject = document.getElementById("subject").value;
			var file = document.getElementById("file").files[0];
			var formdata = new FormData();
			formdata.append("category", category);
			formdata.append("gonumber", gonumber);
			formdata.append("godate", godate);
			formdata.append("subject", subject);
			formdata.append("file", file);
			$("#errorMsg").hide();
			var xhr = new XMLHttpRequest();       
			xhr.open("POST","CountryInformation?actionval=upload", true);
			xhr.send(formdata);
			xhr.onload = function(e) {
				if (this.status == 200) {
					var resu = JSON.parse(this.responseText);
					var res=resu.result;
					if(res == 1){
						$("#myForm").hide();
						$("#updateResponse").append("<div class='ui purple inverted segment'>Successfully Updated the GO Information.</div><div class='actions'><div class='ui approved button' data-value='close' style='margin-left:600px'>Close</div></div>");
					}else{
						$("<p class='ui center aligned basic segment' style='height:5px;color:red' id='errorMsg'>File Upload Failed.Please Try again</p>").insertAfter("#editHead");
					}
				}
			};                    
	   
	});
	
});

function loadDefault(){
	 //get the form data and then serialize that
    dataString = $("#myAjaxRequestForm").serialize();
   
    //get the form data using another method 
    var countryCode = $("input#countryCode").val(); 
    dataString = "year=2016";
   
    //make the AJAX request, dataType is set to json
    //meaning we are expecting JSON data in response from the server
    $.ajax({
        type: "POST",
        url: "CountryInformation",
        data: dataString,
        dataType: "json",
       
        //if received a response from the server
        success: function( data, textStatus, jqXHR) {
            //our country code was correct so we have some information to display
             if(data.length>0){
				$("#ajaxResponse").html("");
            	 for(var i=0;i<data.length;i++){
            		 var obj=data[i];
                     $("#ajaxResponse").append("<tr><td> " + obj[0]+ "</td><td> " + obj[1] + "</td><td> " + obj[2] + "</td><td><a href='#' id='myModal' onclick='loadEditData(\""+obj[1]+"\");'>Edit</a></td></tr>");
            	 }
                 
             } 
             //display error message
             else {
                 $("#ajaxResponse").html("<div><b>Country code in Invalid!</b></div>");
             }
        },
       
        //If there was no resonse from the server
        error: function(jqXHR, textStatus, errorThrown){
             console.log("Something really bad happened " + textStatus);
              $("#ajaxResponse").html(jqXHR.responseText);
        },
       
        //capture the request before it was sent to server
        beforeSend: function(jqXHR, settings){
            //adding some Dummy data to the request
            settings.data += "&dummyData=whatever";
            //disable the button until we get the response
            $('#myButton').attr("disabled", true);
        },
       
        //this is called after the response or error functions are finsihed
        //so that we can take some action
        complete: function(jqXHR, textStatus){
            //enable the button 
            $('#myButton').attr("disabled", false);
        }

    });        
}
function loadEditData(gonumber){
           
  
            
            dataString = "goNumber=" + gonumber;
           
            //make the AJAX request, dataType is set to json
            //meaning we are expecting JSON data in response from the server
            $.ajax({
                type: "POST",
                url: "CountryInformation",
                data: dataString,
                dataType: "json",
               
                //if received a response from the server
                success: function( data, textStatus, jqXHR) {
                    //our country code was correct so we have some information to display
                     if(data.length>0){
						
                    	 for(var i=0;i<data.length;i++){
                    		 var obj=data[i];
                    		 $("#goNumber").val(obj[1]);
                    		 $("#goDate").val(obj[0]);
                    		 $("#subject").val(obj[2]);
                    	 }
                         
                     } 
                     //display error message
                     else {
                         $("#myForm").html("<div><b>Country code in Invalid!</b></div>");
                     }
                },
               
                //If there was no resonse from the server
                error: function(jqXHR, textStatus, errorThrown){
                     console.log("Something really bad happened " + textStatus);
                      $("#myForm").html(jqXHR.responseText);
                },
               
                //capture the request before it was sent to server
                beforeSend: function(jqXHR, settings){
                    //adding some Dummy data to the request
                    settings.data += "&dummyData=whatever";
                    //disable the button until we get the response
                    $('#myForm').attr("disabled", true);
                },
               
                //this is called after the response or error functions are finsihed
                //so that we can take some action
                complete: function(jqXHR, textStatus){
                    //enable the button 
                    $('#myForm').attr("disabled", false);
                }
     
            });        
}
</script>
<script>
$(document).on("click", "#myModal", function () {
    $(".ui.modal").modal("setting", {
        closable: false,
        onApprove: function () {
            return false;
        }
    }).modal("show");
}).on("click", ".ui.button", function () {
    switch ($(this).data("value")) {
        case 'close':
            $("#result").html("easy");
            $(".ui.modal").modal("hide");
            break;
        case 'normal':
            $("#result").html("normal");
            $(".ui.modal").modal("hide");
            break;
        case 'hard':
            $("#result").html("hard");
            $(".ui.modal").modal("hide");
            break;
    }
});
$(function(){
	$('.ui.dropdown').dropdown();
	$('input:text, .ui.button', '.ui.action.input').on('click', function(e) {
    	$('input:file', $(e.target).parents()).click();
	});
	$('input:file', '.ui.action.input').on('change', function(e) {
    	var name = e.target.files[0].name;
    	$('input:text', $(e.target).parent()).val(name);
	});

});
</script>
<body>
<a href="#">Link1</a>
<div style="height:120px">
</div>
   <table class="ui center aligned celled structured table" style="width:600px;margin-left:400px">
   	<thead>
   		<tr>
   			<th>Date</th>
   			<th>GO/Circular/Memo No</th>
   			<th>Subject</th>
   			<th>Edit</th>
   		</tr>
   	</thead>
   	<tbody id="ajaxResponse" class="celled structured table">
   	</tbody>
   </table>  
<!-- Modal -->
<div class="ui small modal">
	<div class="ui header" id="editHead">Edit</div>
    <div class="content" id="updateResponse">
    	<form class="ui form" id="myForm">
   <div class="two fields">
    <div class="field">
    <div class="ui labeled input"> 
    <div class="ui label">Category</div>
      <select class="ui fluid dropdown" name="category" id="category">
        <option value="Go">Go</option>
    <option value="Circular">Circular</option>
    <option value="Memo">Memo</option>
      </select>
      </div>
    </div>
    <div class="field">
        <div class="ui labeled input"> 
	       <div class="ui label">GO/Circular/Memo No</div>
	       <input  name="goNumber" id="goNumber"/>
         </div>
      </div>
  </div>
    <div class="two fields">
      <div class="field">
      	<div class="ui labeled input"> 
      	<div class="ui label">Date</div>
        <input type="text" name="goDate" id="goDate">
        </div>
      </div>
      <div class="field">
      	<div class="ui labeled input"> 
      	<div class="ui label">Subject</div>
        <input type="text" name="subject" id="subject">
      </div>
    </div>
  </div>
 <div class="two fields" style="margin-left:160px;width:800px">
	    <div class="ui fluid action input field">
	        <input type="text" readonly>
	        <input type="file" name="file" id="file">
	        <div class="ui icon button">
	            Upload<i class="cloud upload icon"></i>
	        </div>
	   </div>
  </div>
  <div class="ui blue submit button" id="myButton" style="margin-left:600px">Submit</div>
  <div class="ui error message"></div>
</form>
				
    </div>
</div>

<form class="ui form">
	<div class="ui fluid action input field" style="width:320px">
	        <input type="text" >
	        <div class="ui icon button">
	            <i class="calendar icon"></i>
	        </div>
	   </div>
	
</form>
</body>
</html>
